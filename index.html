<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Bad Peach â€“ Calories & Protein Calculator</title>
  <meta name="description" content="See your daily calories and protein targets, then turn them into simple meals and strength sessions that fit your life." />

  <!-- Fonts (left as-is; headings use Times, body uses system sans to match other pages) -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;800&display=swap" rel="stylesheet">

  <style>
    /* === Brand system to match meal-plan/results === */
    :root{
      --brand-cream:#fffefc;
      --brand-blushL:#FFEFEA;
      --brand-blushD:#ebcac2;
      --brand-black:#191919;

      --paper:#FFFFFF;
      --text:#333333;
      --muted:#6B6B6B;
      --border:#EDE7E2;
      --shadow:0 14px 32px rgba(0,0,0,.10);

      --ok:#1a7f37;
      --error:#c62828;
      --focus:rgba(199,143,122,.18); /* warm focus */
      --radius-card:22px;
      --radius-btn:6px;
    }

    *{box-sizing:border-box}
    html,body{margin:0;padding:0;background:var(--brand-cream);color:var(--text)}
    body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif;line-height:1.6;font-size:17px}

    /* Headings match other pages */
    h1,h2,h3,h4{font-family:"Times New Roman",Times,serif;letter-spacing:.02em;color:var(--brand-black)}
    .caps{text-transform:uppercase;letter-spacing:.06em}

    h1{font-size:clamp(22px, 6.6vw, 40px); line-height:1.1; margin:0 0 6px}
    h2{font-size:clamp(20px,3.2vw,32px); margin:0 0 8px}
    .one-line{ white-space:nowrap; }
    h2.one-line{ font-size:clamp(14px, 4.2vw, 28px); line-height:1.05; }

    /* Layout */
    .wrap{max-width:1100px;margin:0 auto;padding:24px}
    .grid{display:grid;gap:24px}
    .grid-2{grid-template-columns:1fr}
    @media (min-width:980px){.grid-2{grid-template-columns:1.15fr .85fr}}

    /* Cards */
    .card{
      background:var(--paper);
      border:1px solid var(--border);
      border-radius:var(--radius-card);
      padding:20px;
      box-shadow:var(--shadow);
    }

    /* Section backgrounds (kept semantically same) */
    .on-blush{background:linear-gradient(180deg, rgba(233,191,175,.35), rgba(233,191,175,.16))}
    .on-cream{background:var(--brand-cream);color:var(--brand-black)}
    .on-blush-light{background:linear-gradient(180deg, rgba(233,191,175,.22), rgba(233,191,175,.10))}

    .note{font-size:13px;color:var(--muted)}

    /* Buttons: dark blush base w/ black text; hover black + cream */
    .btn{
      display:inline-block;cursor:pointer;text-decoration:none;
      padding:12px 16px;border-radius:var(--radius-btn);font-weight:800;
      font-family:inherit;font-size:12px;letter-spacing:.06em;text-transform:uppercase;
      transition:transform .04s ease, filter .15s ease, background .15s ease, color .15s ease, border-color .15s ease;
      border:2px solid var(--brand-black);
      background:var(--brand-blushD);
      color:var(--brand-black);
    }
    .btn:hover{background:var(--brand-black);color:var(--brand-cream)}
    .btn:active{transform:translateY(1px)}
    .btn-xs{font-size:11px;padding:8px 12px;border-radius:var(--radius-btn)}
    /* legacy class names kept */
    .btn-dark{border-color:var(--brand-black)}
    .btn-cream{border-color:var(--brand-black)}

    /* Hero â€” blush gradient to match meal-plan header */
    header.hero{
      background:linear-gradient(180deg,var(--brand-blushL),var(--brand-blushD));
      border-bottom:1px solid var(--border);
      color:var(--brand-black);
    }
    .hero-inner{display:grid;gap:12px;align-items:center}
    .brand-kicker{font-size:.85rem;letter-spacing:.25em;color:var(--brand-black);opacity:.95}
    .hero-subline{font-size:11px;margin:-2px 0 8px;opacity:.75}
    p.lead{font-size:clamp(16px, 3.2vw, 19px);margin:.3rem 0 0}

    /* Form */
    .form-grid{display:grid;gap:14px}
    .form-2{grid-template-columns:1fr}
    @media (min-width:780px){.form-2{grid-template-columns:1fr 1fr}}
    label{font-weight:800;letter-spacing:.04em;text-transform:uppercase;font-size:12px;color:var(--brand-black)}
    .optional-note{font-weight:400;text-transform:none;letter-spacing:0;opacity:.9}

    input,select{
      width:100%;height:48px;padding:12px;border:1px solid var(--border);border-radius:14px;background:#fff;font-size:16px;line-height:24px;
      outline:none; transition: border-color .2s ease, box-shadow .2s ease;
    }
    input:focus, select:focus{border-color:#C78F7A; box-shadow:0 0 0 4px var(--focus)}
    .inline{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    select.placeholder{ color: rgba(25,25,25,.5); }

    /* Validation nudges */
    .field{position:relative}
    .hint{display:none;font-size:12px;color:var(--error);margin-top:6px}
    .field.error input, .field.error select{border-color:var(--error); box-shadow:0 0 0 3px rgba(198,40,40,.12)}
    .field.error .hint{display:block}
    .field.ok input, .field.ok select{border-color:var(--ok); box-shadow:0 0 0 3px rgba(26,127,55,.12)}
    .tiny-check{display:none;color:var(--ok);font-size:12px;margin-top:6px}
    .field.ok .tiny-check{display:inline-flex;align-items:center;gap:6px}

    /* Results */
    .results{display:none}
    .result-box{
      background:#fff;border:2px solid var(--brand-blushD);border-radius:14px;padding:18px;
      box-shadow:0 6px 18px rgba(0,0,0,.05)
    }
    .result-number{font-size:30px;font-weight:800;font-family:inherit;color:var(--brand-black)}
    .result-cta{margin-top:10px}

    /* Media */
    .media-9x16{aspect-ratio:9/16;width:100%;max-width:420px;object-fit:cover;background:#fff;margin-inline:auto;border-radius:16px;border:1px solid var(--border);box-shadow:var(--shadow)}

    /* Sticky bottom CTA (mobile) */
    .sticky-cta{
      position:fixed; left:0; right:0; bottom:0; z-index:9999;
      background:rgba(25,25,25,.96); color:#fff; padding:10px 14px; display:none;
      align-items:center; justify-content:space-between; gap:10px;
      box-shadow:0 -6px 20px rgba(0,0,0,.25);
      padding-bottom:calc(10px + env(safe-area-inset-bottom, 0px));
    }
    .sticky-cta .copy{font-size:13px;line-height:1.3}
    .sticky-cta .x{background:transparent;border:none;color:#fff;opacity:.8;font-size:18px;line-height:1;cursor:pointer}
    @media (min-width:681px){ .sticky-cta{display:none !important} }

    /* Utility */
    .affiliate-img{border-radius:16px;box-shadow:var(--shadow)}
    footer .small{color:rgba(25,25,25,.55)}

    /* Affiliate card styles to match Results page */
    #affiliate{background:var(--brand-cream);}
    #affiliate .aff-card{
      background:#fff;border:1px solid var(--border);border-radius:22px;
      box-shadow:var(--shadow);padding:20px;
    }
    #affiliate .aff-grid{
      display:grid;gap:22px;align-items:center;
      grid-template-columns:1fr;
    }
    @media (min-width:900px){
      #affiliate .aff-grid{grid-template-columns:1.1fr 1fr;}
    }
    #affiliate .aff-photo{
      width:100%;max-width:640px;border-radius:16px;
      box-shadow:0 10px 30px rgba(0,0,0,.08);border:1px solid var(--border);
    }
    #affiliate h2{margin:0 0 8px}
    #affiliate .aff-copy{font-size:16px;line-height:1.6;color:var(--text)}
    #affiliate .aff-copy strong{color:var(--brand-black)}
  </style>
</head>
<body>

  <!-- STICKY CTA (mobile) -->
  <div id="stickyCta" class="sticky-cta" role="region" aria-label="Sticky purchase banner">
    <div class="copy"><strong>Ready?</strong> Turn your numbers into a results driven fitness plan.</div>
    <a href="https://badpeachfitness.store/shop/3d377cf8-b293-42ba-91f2-593086a5a741" class="btn btn-cream btn-xs">Get Fit Blueprint + Meal Plan Generator</a>
    <button class="x" aria-label="Close">Ã—</button>
  </div>

  <!-- HERO -->
  <header class="hero">
    <div class="wrap hero-inner">
      <div>
        <div class="brand-kicker caps">BAD PEACH</div>
        <h1 class="caps"><span>Calories&nbsp;&amp;&nbsp;Protein</span> Calculator</h1>
        <div class="caps hero-subline">For women in their mid-30's and up</div>
        <p class="lead">Discover your daily calories and protein amount.</p>
      </div>
      <!-- (desktop header media intentionally omitted) -->
    </div>
  </header>

  <!-- CALCULATOR + EMAIL GATE -->
  <section id="calculator" class="on-blush">
    <div class="wrap">
      <div class="card">
        <h2 class="caps one-line">YOUR FIT FOREVER CALCULATOR</h2>

        <!-- Beacons Email Form -->
        <div id="beacons-signup-wrapper" style="margin-bottom:18px;">
          <script>
            (function () {
              var s=document.createElement("script");
              var t=Math.floor(new Date().getTime()/120000);
              s.type="module";
              s.async=1;
              s.src=`https://beacons.ai/embeds/emailForm.js?v=${t}&b=badpeachfitness&f=b20d2ccb-0967-43cc-bc9b-d844063e992b`;
              document.body.appendChild(s);
            })();
          </script>
           <div id="b20d2ccb-0967-43cc-bc9b-d844063e992b"></div>
        </div>

        <!-- ðŸ”“ Full content (revealed after email) -->
        <div id="fullLanding" style="display:none;">

          <p><strong>Enter your custom details below.</strong></p>

          <!-- RESTORED: full calculator form + results -->
          <form id="calcForm" class="form-grid form-2" novalidate>
            <div class="field" data-name="age">
              <label for="age">Age</label>
              <input id="age" type="number" min="14" max="90" placeholder="Years" required>
              <div class="hint">Please enter an age between 14 and 90.</div>
              <div class="tiny-check">âœ” Looks good</div>
            </div>

            <div class="field" data-name="height">
              <label>Height</label>
              <div class="inline">
                <input id="heightFt" type="number" min="4" max="7" placeholder="Feet" required>
                <input id="heightIn" type="number" min="0" max="11" placeholder="Inches" required>
              </div>
              <div class="hint">Enter feet (4â€“7) and inches (0â€“11).</div>
              <div class="tiny-check">âœ” Height captured</div>
            </div>

            <div class="field" data-name="weight">
              <label for="weight">Current Weight</label>
              <input id="weight" type="number" min="80" max="400" placeholder="Pounds" required>
              <div class="hint">Please enter a weight between 80 and 400 lb.</div>
              <div class="tiny-check">âœ” Weight looks valid</div>
            </div>

            <div class="field" data-name="activity">
              <label for="activity">
                Average Activity Level
                <span class="optional-note">(Choose a conservative choice if you're unsure)</span>
              </label>
              <select id="activity" required>
                <option value="">Select</option>
                <option value="1.2">Sedentary â€” under 5k steps/day, no workouts, sit most of the day.</option>
                <option value="1.375">Lightly Active â€” 5kâ€“8k steps/day, 1â€“3 light workouts/week.</option>
                <option value="1.55">Moderately active â€” 8kâ€“12k steps/day, 3â€“5 moderate intensity workouts/week, moving about a lot of the day.</option>
                <option value="1.725">Very active â€” 12k+ steps/day, 6â€“7 intense workouts/week, on feet all day long.</option>
              </select>
              <div class="hint">Please choose your activity level.</div>
              <div class="tiny-check">âœ” Activity selected</div>
            </div>

            <div class="field" data-name="goal">
              <label for="goal">Fitness Goal</label>
              <select id="goal" required>
                <option value="">Select</option>
                <option value="fatloss">Fat Loss</option>
                <option value="maintain">Maintenance</option>
                <option value="muscle">Muscle Gain</option>
              </select>
              <div class="hint">Please choose a goal.</div>
              <div class="tiny-check">âœ” Goal selected</div>
            </div>

            <!-- PROTEIN CALCULATION -->
            <div class="field" data-name="protein">
              <label for="goalWeight">
                Your Goal Weight For Protein Calculation
                <span class="optional-note" style="display:block;margin-top:4px">(recommended if you have significant weight to lose)</span>
              </label>
              <input id="goalWeight" type="number" min="90" max="400" placeholder="Goal weight in pounds">

              <label for="intensity" style="margin-top:10px">
                Rate Your Average Training Intensity
                <span class="optional-note" style="display:block;margin-top:4px">(used to determine your recommended daily protein grams)</span>
              </label>
              <select id="intensity" class="placeholder">
                <option value="" selected>Select</option>
                <option value="Light">Light (1.0 g protein / lb goal bodyweight)</option>
                <option value="Moderate">Moderate (1.1 g protein / lb goal bodyweight)</option>
                <option value="Intense">Intense (1.2 g protein / lb goal bodyweight)</option>
              </select>
            </div>

            <div style="grid-column:1/-1;display:flex;gap:12px;flex-wrap:wrap">
              <button type="submit" class="btn btn-dark">Calculate</button>
              <button type="button" id="resetBtn" class="btn btn-cream">Reset</button>
            </div>
          </form>

          <!-- RESULTS -->
          <div id="results" class="results" style="margin-top:22px">
            <h3 class="caps">Your Results</h3>

            <div class="grid form-2" style="margin-top:12px">
              <div class="result-box">
                <div class="caps" style="font-size:12px;opacity:.8">Your TDEE</div>
                <div class="result-number" id="tdeeOut">â€”</div>
                <div class="note">Total daily calories burned.</div>
              </div>

              <div class="result-box">
                <div class="caps" style="font-size:12px;opacity:.8">Your fat loss calories</div>
                <div class="result-number" id="fatlossOut">â€”</div>
                <div class="result-cta">
                  <a href="https://badpeachfitness.store/shop/3d377cf8-b293-42ba-91f2-593086a5a741" class="btn btn-dark btn-xs">Get your fat loss plan</a>
                </div>
              </div>

              <div class="result-box">
                <div class="caps" style="font-size:12px;opacity:.8">Your maintenance calories</div>
                <div class="result-number" id="maintainOut">â€”</div>
                <div class="result-cta">
                  <a href="https://badpeachfitness.store/shop/3d377cf8-b293-42ba-91f2-593086a5a741" class="btn btn-dark btn-xs">Get your maintenance plan</a>
                </div>
              </div>

              <div class="result-box">
                <div class="caps" style="font-size:12px;opacity:.8">Your muscle gain calories</div>
                <div class="result-number" id="muscleOut">â€”</div>
                <div class="result-cta">
                  <a href="https://badpeachfitness.store/shop/3d377cf8-b293-42ba-91f2-593086a5a741" class="btn btn-dark btn-xs">Get your muscle gain plan</a>
                </div>
              </div>

              <div class="result-box" style="grid-column:1/-1">
                <div class="caps" style="font-size:12px;opacity:.8">Your daily protein</div>
                <div class="result-number" id="proteinOut">â€”</div>
                <div class="note" id="proteinNote"></div>
                <div class="result-cta">
                  <a href="https://badpeachfitness.store/shop/3d377cf8-b293-42ba-91f2-593086a5a741" class="btn btn-dark btn-xs">See protein-friendly meals</a>
                </div>
              </div>
            </div>

            <p style="margin-top:14px;font-style:italic">These are your numbers. The plan makes them work.</p>
            <a href="https://badpeachfitness.store/shop/3d377cf8-b293-42ba-91f2-593086a5a741" class="btn">Get Fit Blueprint + Meal Plan Generator</a>
          </div>

        </div><!-- /#fullLanding -->
      </div>
    </div>
  </section>

  <!-- YOUR NUMBERS ARE JUST THE BEGINNING -->
  <section class="on-blush-light" id="moreSections" style="display:none;">
    <div class="wrap grid-2">
      <!-- LEFT: Content card (cream inside) -->
      <div class="card" style="background:var(--brand-cream);">
        <h2 class="caps" style="margin-top:0">Your Numbers Are Just The Beginning</h2>
        <ul style="margin:0;padding-left:18px">
          <li>185+ pages fitness blueprint <strong>designed</strong> for women in their mid-30's and up.</li>
          <li>Progressive overload strength training plans + exercise demos and personal training tips for maximum results.</li>
          <li>How to hit your fitness goals for fat loss, maintenance, and muscle gain.</li>
          <li><strong>Lifetime access to the one-of-a-kind Bad Peach Meal Plan Generator.</strong></li>
        </ul>
        <a href="https://badpeachfitness.store/shop/3d377cf8-b293-42ba-91f2-593086a5a741" class="btn btn-xs" style="margin-top:12px">Get Fit Blueprint + Meal Plan Generator</a>
      </div>

      <!-- RIGHT: Peek video -->
      <div class="card" style="text-align:center; margin-top:12px;">
        <div class="caps" style="font-size:12px;opacity:.8;margin-bottom:8px">Sneak peek inside the e-book</div>
        <div class="media-9x16" id="previewShell2">
          <!-- keep autoplay so it starts when revealed -->
          <video id="previewVid2" playsinline muted loop preload="metadata" autoplay poster="cover.png" style="width:100%;height:100%;object-fit:cover;border-radius:16px">
            <source src="Slower E-book Flip.mp4" type="video/mp4">
          </video>
        </div>
      </div>
    </div>
  </section>

  <!-- AFFILIATE (matches Results page) -->
  <section id="affiliate" class="on-cream" style="display:none;">
    <div class="wrap">
      <div class="aff-card">
        <div class="aff-grid">
          <!-- Left: image -->
          <a href="https://badpeachfitness.store/affiliates" target="_blank" rel="noopener">
            <img src="Affiliate.png" class="aff-photo" alt="Affiliate Opportunity - Share and Make Money">
          </a>

          <!-- Right: copy + CTA -->
          <div>
            <h2 class="caps">Become An Affiliate</h2>
            <p class="aff-copy">
              Share the <em>Becoming Your Fittest Forever</em> system (with lifetime access to the custom meal plan generator) and be rewarded generously as a thank you! When you help other women glow up, you should benefit too.
            </p>
            <p class="aff-copy"><strong>Earn 50% commission</strong> for every purchase made through your unique link. Click below to get your link today!</p>
            <a href="https://badpeachfitness.store/affiliates" class="btn">Become an Affiliate</a>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- INSTAGRAM (tagline removed as requested) -->
  <section id="igSection" class="on-cream" style="display:none;">
    <div class="wrap">
      <div class="card" style="text-align:center;">
        <h2 class="caps" style="margin-top:0">Follow Along on Instagram</h2>
        <a href="https://instagram.com/bad.peach.fitness" target="_blank" rel="noopener" class="btn">Follow @bad.peach.fitness</a>
      </div>
    </div>
  </section>

  <!-- FOOTER (AUTO YEAR + NEW TEXT) -->
  <footer id="footer" style="display:none;">
    <div class="wrap">
      <div class="small" style="margin-top:12px;color:rgba(25,25,25,.55)">
        Â© <span id="yr"></span> Bad Peach Fitness â€“ Becoming Your Fittest Forever. All rights reserved.
      </div>
    </div>
  </footer>

  <!-- ==== Scripts ==== -->
  <script>
    // Auto year
    document.getElementById('yr').textContent = new Date().getFullYear();

    // Minimal unlock logic + PERSISTENCE FIX
    const beaconsWrap = document.getElementById('beacons-signup-wrapper');
    const fullLanding = document.getElementById('fullLanding');
    const moreSections= document.getElementById('moreSections');
    const affiliate   = document.getElementById('affiliate');
    const igSection   = document.getElementById('igSection');
    const footer      = document.getElementById('footer');
    const embedRoot   = document.getElementById('b20d2ccb-0967-43cc-bc9b-d844063e992b');

    function show(el){ if(el) el.style.display = (el.id === 'stickyCta' ? 'flex' : 'block'); }
    function hide(el){ if(el) el.style.display = 'none'; }

    // âœ… Persist unlock across refreshes / form reloads
    function persistUnlock(){
      try { localStorage.setItem('badpeach_calc_unlocked', '1'); } catch(e){}
    }
    function checkPersistedUnlock(){
      try {
        if(localStorage.getItem('badpeach_calc_unlocked') === '1'){
          revealAll(/*fromPersist*/true);
        }
      } catch(e){}
    }

    function revealAll(fromPersist){
      hide(beaconsWrap);
      show(fullLanding);
      show(moreSections);
      show(affiliate);
      show(igSection);
      show(footer);
      if(!fromPersist) persistUnlock(); // only set on actual reveal events
      // Attempt to start preview video when revealed (no UI change)
      try {
        const v = document.getElementById('previewVid2');
        if (v) { v.play().catch(()=>{}); }
      } catch(e){}
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    // Listen for Beacons postMessage events
    window.addEventListener('message', (event) => {
      const d = event.data;
      if(!d) return;
      if (
        d.type === 'BEACONS_FORM_SUBMITTED' ||
        d.type === 'BEACONS_EMAIL_SUBMITTED' ||
        d.event === 'formSubmitted' ||
        d.event === 'emailSubmitted' ||
        d.beaconsFormSubmitted === true ||
        d.status === 'success'
      ){
        revealAll();
      }
    });

    // Fallback: observe success text inside embed root
    if(embedRoot){
      const successMatchers = [
        'perfect!', 'thanks', 'thank you', 'check your email', 'check your inbox',
        'confirmation', 'success', 'youâ€™re in', 'you are in', 'submitted'
      ];
      const obs = new MutationObserver(()=>{
        const txt=(embedRoot.textContent || '').toLowerCase();
        if(successMatchers.some(k => txt.includes(k))){
          obs.disconnect();
          revealAll();
        }
      });
      obs.observe(embedRoot, { childList:true, subtree:true });
    }

    // Optional URL unlock
    const usp=new URLSearchParams(location.search);
    if(usp.get('unlock')==='1' || location.hash==='#unlock'){ revealAll(); }

    // ðŸ” Check persisted state on load
    checkPersistedUnlock();

    /* ----------------- Calculator Logic (UNCHANGED) ----------------- */
    const form = document.getElementById('calcForm');
    const resultsEl = document.getElementById('results');
    const tdeeOut = document.getElementById('tdeeOut');
    const fatlossOut = document.getElementById('fatlossOut');
    const maintainOut = document.getElementById('maintainOut');
    const muscleOut = document.getElementById('muscleOut');
    const proteinOut = document.getElementById('proteinOut');
    const proteinNote = document.getElementById('proteinNote');
    const resetBtn = document.getElementById('resetBtn');
    const intensitySelect = document.getElementById('intensity');

    function inRange(val, min, max){ return !isNaN(val) && val >= min && val <= max; }
    function setState(wrap, ok){
      wrap.classList.remove('error','ok');
      wrap.classList.add(ok ? 'ok' : 'error');
    }
    const fields = {
      age: { el: document.getElementById('age'), min:14, max:90, wrap: document.querySelector('[data-name="age"]') },
      heightFt: { el: document.getElementById('heightFt'), min:4, max:7 },
      heightIn: { el: document.getElementById('heightIn'), min:0, max:11, wrap: document.querySelector('[data-name="height"]') },
      weight: { el: document.getElementById('weight'), min:80, max:400, wrap: document.querySelector('[data-name="weight"]') },
      activity: { el: document.getElementById('activity'), wrap: document.querySelector('[data-name="activity"]') },
      goal: { el: document.getElementById('goal'), wrap: document.querySelector('[data-name="goal"]') }
    };
    function validateField(key){
      const f = fields[key];
      if(!f) return true;
      if(f.el.tagName === 'SELECT'){
        const valid = !!f.el.value;
        setState(f.wrap, valid);
        return valid;
      }else{
        const v = parseFloat(f.el.value);
        const min = f.min ?? -Infinity, max = f.max ?? Infinity;
        const valid = inRange(v, min, max);
        if(f.wrap) setState(f.wrap, valid);
        else setState(f.el.parentElement, valid);
        return valid;
      }
    }
    Object.keys(fields).forEach(k => {
      fields[k].el.addEventListener('blur', () => validateField(k));
      fields[k].el.addEventListener('input', () => validateField(k));
      if(fields[k].el.tagName === 'SELECT'){
        fields[k].el.addEventListener('change', () => validateField(k));
      }
    });

    form.addEventListener('submit', function(e){
      e.preventDefault();

      const order = ['age','heightFt','heightIn','weight','activity','goal'];
      let firstInvalid = null;
      order.forEach(k => {
        const ok = validateField(k);
        if(!ok && !firstInvalid) firstInvalid = fields[k].el;
      });
      if(firstInvalid){
        firstInvalid.focus({preventScroll:false});
        firstInvalid.scrollIntoView({behavior:'smooth',block:'center'});
        return;
      }

      const age = parseFloat(fields.age.el.value);
      const ft  = parseFloat(fields.heightFt.el.value);
      const inch= parseFloat(fields.heightIn.el.value);
      const weightLb = parseFloat(fields.weight.el.value);
      const activity = parseFloat(fields.activity.el.value);
      const goalWeight = parseFloat(document.getElementById('goalWeight').value);

      const intensitySelectEl = document.getElementById('intensity');
      const intensitySel = (intensitySelectEl && intensitySelectEl.value) ? intensitySelectEl.value : 'Moderate';
      const intensityMap = { Light: 1.0, Moderate: 1.1, Intense: 1.2 };
      const intensity = intensityMap[intensitySel] ?? 1.1;

      const heightIn = (ft * 12) + inch;

      // Harris-Benedict for women
      const bmr = 655 + (4.35 * weightLb) + (4.7 * heightIn) - (4.7 * age);
      const tdee = bmr * activity;

      const fatloss = tdee * 0.85;
      const maintain = tdee;
      const muscle = tdee * 1.15;

      let baseWeight = weightLb;
      let sourceLabel = 'current weight';
      if(!isNaN(goalWeight) && goalWeight > 0){
        baseWeight = goalWeight;
        sourceLabel = 'goal weight';
      }
      const protein = intensity * baseWeight;

      tdeeOut.textContent = Math.round(tdee).toLocaleString();
      fatlossOut.textContent = Math.round(fatloss).toLocaleString();
      maintainOut.textContent = Math.round(maintain).toLocaleString();
      muscleOut.textContent = Math.round(muscle).toLocaleString();
      proteinOut.textContent = Math.round(protein) + ' g';

      proteinNote.textContent = `Based on your ${sourceLabel} Ã— ${intensity.toFixed(1)} (Intensity: ${intensitySel}).`;

      resultsEl.style.display='block';
      resultsEl.scrollIntoView({behavior:'smooth', block:'start'});
    });

    /* ==== RESET BUTTON (added) ==== */
    resetBtn.addEventListener('click', () => {
      form.reset();

      // Clear validation states
      Object.keys(fields).forEach(k => {
        const wrap = fields[k].wrap || fields[k].el.parentElement;
        if (wrap) wrap.classList.remove('ok','error');
      });

      // Ensure selects return to placeholder
      try {
        document.getElementById('activity').value = '';
        document.getElementById('goal').value = '';
        const intensityEl = document.getElementById('intensity');
        if (intensityEl) intensityEl.value = '';
      } catch(e){}

      // Clear results and hide section
      tdeeOut.textContent = 'â€”';
      fatlossOut.textContent = 'â€”';
      maintainOut.textContent = 'â€”';
      muscleOut.textContent = 'â€”';
      proteinOut.textContent = 'â€”';
      proteinNote.textContent = '';
      resultsEl.style.display = 'none';

      form.scrollIntoView({ behavior: 'smooth', block: 'start' });
    });

    // Sticky helpers (original references preserved)
    const sticky = document.getElementById('stickyCta');
    const stickyClose = sticky.querySelector('.x');
    function padBodyForSticky(){
      try{
        const h = sticky.offsetHeight || 0;
        document.body.style.paddingBottom = (h + 8) + 'px';
      }catch(e){}
    }
    stickyClose.addEventListener('click', () => {
      sticky.dataset.closed = '1';
      hide(sticky);
      document.body.style.paddingBottom = '';
    });
    function maybeShowSticky(){
      if(window.matchMedia('(max-width:680px)').matches && sticky.dataset.closed !== '1'){
        show(sticky);
        padBodyForSticky();
      }
    }
    window.addEventListener('resize', ()=>{ if(sticky.style.display==='block') padBodyForSticky(); });
  </script>
</body>
</html>
